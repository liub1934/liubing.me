import R from"@temp/slimsearch/index.js";import{search as z,getStoredFields as C,autoSuggest as F,loadJSONIndex as L}from"slimsearch";import{entries as O}from"@vuepress/helper/shared";const S=(e,o)=>{const i=e.toLowerCase(),s=o.toLowerCase(),t=[];let n=0,l=0;const r=(c,f=!1)=>{let u;l===0?u=c.length>20?`… ${c.slice(-20)}`:c:f?u=c.length+l>100?`${c.slice(0,100-l)}… `:c:u=c.length>20?`${c.slice(0,20)} … ${c.slice(-20)}`:c,u&&t.push(u),l+=u.length,f||(t.push(["mark",o]),l+=o.length,l>=100&&t.push(" …"))};let d=i.indexOf(s,n);if(d===-1)return null;for(;d>=0;){const c=d+s.length;if(r(e.slice(n,d)),n=c,l>100)break;d=i.indexOf(s,n)}return l<100&&r(e.slice(n),!0),t},T=(e,o)=>o.contents.reduce((i,[,s])=>i+s,0)-e.contents.reduce((i,[,s])=>i+s,0),$=(e,o)=>Math.max(...o.contents.map(([,i])=>i))-Math.max(...e.contents.map(([,i])=>i)),M=(e,o,i={})=>{const s={};return z(o,e,{boost:{h:2,t:1,c:4},prefix:!0,...i}).forEach(t=>{const{id:n,terms:l,score:r}=t,d=n.includes("@"),c=n.includes("#"),[f,u]=n.split(/[#@]/),h=Number(f),m=l.sort((p,a)=>p.length-a.length).filter((p,a)=>l.slice(a+1).every(g=>!g.includes(p))),{contents:y}=s[h]??={title:"",contents:[]};if(d)y.push([{type:"customField",id:h,index:u,display:m.map(p=>t.c.map(a=>S(a,p))).flat().filter(p=>p!==null)},r]);else{const p=m.map(a=>S(t.h,a)).filter(a=>a!==null);if(p.length&&y.push([{type:c?"heading":"title",id:h,...c&&{anchor:u},display:p},r]),"t"in t&&t.t)for(const a of t.t){const g=m.map(x=>S(a,x)).filter(x=>x!==null);g.length&&y.push([{type:"text",id:h,...c&&{anchor:u},display:g},r])}}}),O(s).sort(([,t],[,n])=>__SLIMSEARCH_SORT_STRATEGY__==="total"?T(t,n):$(t,n)).map(([t,{title:n,contents:l}])=>{if(!n){const r=C(o,t);r&&(n=r.h)}return{title:n,contents:l.map(([r])=>r)}})},_=(e,o,i={})=>{const s=F(o,e,{fuzzy:.2,maxFuzzy:3,...i}).map(({suggestion:t})=>t);return e.includes(" ")?s:s.filter(t=>!t.includes(" "))};self.onmessage=async({data:{type:e="all",query:o,locale:i="/",options:s,id:t}})=>{const{default:n}=await R[i](),l=L(n,{fields:["h","t","c"],storeFields:["h","t","c"]});e==="suggest"?self.postMessage([e,t,_(o,l,s)]):e==="search"?self.postMessage([e,t,M(o,l,s)]):self.postMessage({suggestions:[e,t,_(o,l,s)],results:[e,t,M(o,l,s)]})};
//# sourceMappingURL=index.js.map
